/*
 * Copyright (C) 2017 Atlas of Living Australia
 * All Rights Reserved.
 * The contents of this file are subject to the Mozilla Public
 * License Version 1.1 (the "License"); you may not use this file
 * except in compliance with the License. You may obtain a copy of
 * the License at http://www.mozilla.org/MPL/
 * Software distributed under the License is distributed on an "AS
 * IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
 * implied. See the License for the specific language governing
 * rights and limitations under the License.
 */

package au.org.ala.alerts

import grails.test.mixin.integration.Integration
import grails.transaction.*
import org.springframework.beans.factory.annotation.Autowired
import spock.lang.*

@Integration
@Rollback
class DiffServiceSpec extends Specification {
    @Autowired
    DiffService diffService

    def setup() {
    }

    def cleanup() {
    }

    void "test hasChangedJsonDiff for blogs and news query"() {
        given:
        def query = Query.findByName("Blogs and News")
        def json1 = "{\"status\":\"ok\",\"count\":1,\"pages\":279,\"category\":{\"id\":2,\"slug\":\"blogs-news\",\"title\":\"Blogs &amp; news\",\"description\":\"\",\"parent\":0,\"post_count\":279},\"posts\":[{\"id\":38260,\"type\":\"post\",\"slug\":\"spotlight-on-ala-users-clare-pearce\",\"url\":\"https:\\/\\/www.ala.org.au\\/blogs-news\\/spotlight-on-ala-users-clare-pearce\\/\",\"status\":\"publish\",\"title\":\"Spotlight on ALA Users &#8211; Clare Pearce\",\"title_plain\":\"Spotlight on ALA Users &#8211; Clare Pearce\",\"content\":\"<p>Clare is the Community Engagement Officer with Parks and Wildlife based in Katherine. Part of her role involves working with kids in the Junior Ranger program. The program delivers hands-on activities based in environmental education for between 10-30 kids at a time, including activities such as hiking, tracking, navigation, spotlighting and birdwatching.<\\/p><div id=\\\"attachment_38264\\\" style=\\\"width: 310px\\\" class=\\\"wp-caption aligncenter\\\"><img src=\\\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3-300x300.png\\\" alt=\\\"Egretta picata. Image by Clare Pearce - ALA Individual Sightings\\\" width=\\\"300\\\" height=\\\"300\\\" class=\\\"size-medium wp-image-38264\\\" srcset=\\\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3-300x300.png 300w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3-150x150.png 150w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3.png 441w\\\" sizes=\\\"(max-width: 300px) 100vw, 300px\\\" \\/><p class=\\\"wp-caption-text\\\">Egretta picata. Image by Clare Pearce &#8211; ALA Individual Sightings<\\/p><\\/div><p>Her groups don\\u2019t do any formal collecting activities, but Clare enters some of the images of things they find during their activities in and around the Nitmiluk National Park. She said that the kids are getting better at being careful with the animals they find and they\\u2019re especially keen on frogs, bugs and geckos.<\\/p><div id=\\\"attachment_38262\\\" style=\\\"width: 285px\\\" class=\\\"wp-caption aligncenter\\\"><img src=\\\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1-300x300.png\\\" alt=\\\"Platyplectrum ornatum. Image by Clare Pearce - ALA Individual Sightings\\\" width=\\\"275\\\" height=\\\"275\\\" class=\\\" wp-image-38262\\\" srcset=\\\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1-300x300.png 300w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1-150x150.png 150w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1.png 682w\\\" sizes=\\\"(max-width: 275px) 100vw, 275px\\\" \\/><p class=\\\"wp-caption-text\\\">Platyplectrum ornatum. Image by Clare Pearce &#8211; ALA Individual Sightings<\\/p><\\/div><p>As well as contributing the sightings to the ALA database, she uses the species information, images and species distribution maps to assist in identifying the specimens.<\\/p><p>Ranger Clare also presents talks to schools and community members and contributes articles to websites and newspapers. The ALA is one of the resources she uses to check facts while preparing these.<\\/p><div id=\\\"attachment_38265\\\" style=\\\"width: 278px\\\" class=\\\"wp-caption aligncenter\\\"><img src=\\\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4-300x298.png\\\" alt=\\\"Nymphaea violacea. Image by Clare Pearce - ALA Individual Sightings\\\" width=\\\"268\\\" height=\\\"266\\\" class=\\\" wp-image-38265\\\" srcset=\\\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4-300x298.png 300w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4-150x150.png 150w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4.png 485w\\\" sizes=\\\"(max-width: 268px) 100vw, 268px\\\" \\/><p class=\\\"wp-caption-text\\\">Nymphaea violacea. Image by Clare Pearce &#8211; ALA Individual Sightings<\\/p><\\/div><p>She was initially reluctant to contribute to the ALA as she didn\\u2019t think her data was \\u201cgood enough\\u201d. With her wealth of knowledge and photography skills, we are glad that she started adding her sightings to share with others through the ALA.<\\/p><p>Please <a href=\\\"https:\\/\\/www.ala.org.au\\/about-the-atlas\\/contact-us\\/\\\">contact us<\\/a> if you would like to share how you use the ALA.<\\/p>\",\"excerpt\":\"<p>Clare Pearce\\u2019s images in the ALA\\u2019s Recent Sightings could be part of a tourism campaign advertising the Northern Territory.<\\/p>\\n\",\"date\":\"2017-08-23 11:12:47\",\"modified\":\"2017-08-23 11:12:47\",\"categories\":[{\"id\":147,\"slug\":\"atlas-user-profiles\",\"title\":\"Atlas user profiles\",\"description\":\"\",\"parent\":0,\"post_count\":10},{\"id\":2,\"slug\":\"blogs-news\",\"title\":\"Blogs &amp; news\",\"description\":\"\",\"parent\":0,\"post_count\":279}],\"tags\":[],\"author\":{\"id\":21,\"slug\":\"superstarynhotmail-com\",\"name\":\"Taryn\",\"first_name\":\"Taryn\",\"last_name\":\"Johnson\",\"nickname\":\"superstaryn@hotmail.com\",\"url\":\"\",\"description\":\"\"},\"comments\":[],\"attachments\":[{\"id\":38262,\"url\":\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1.png\",\"slug\":\"jul173-1\",\"title\":\"jul17(3.1)\",\"description\":\"Platyplectrum ornatum. Image by Clare Pearce - ALA Individual Sightings\",\"caption\":\"Platyplectrum ornatum. Image by Clare Pearce - ALA Individual Sightings\",\"parent\":38260,\"mime_type\":\"image\\/png\",\"images\":{\"full\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1.png\",\"width\":682,\"height\":684},\"thumbnail\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1-150x150.png\",\"width\":150,\"height\":150},\"medium\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1-300x300.png\",\"width\":300,\"height\":300},\"medium_large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1.png\",\"width\":682,\"height\":684},\"large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.1.png\",\"width\":682,\"height\":684}}},{\"id\":38264,\"url\":\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3.png\",\"slug\":\"jul173-3\",\"title\":\"jul17(3.3)\",\"description\":\"Egretta picata. Image by Clare Pearce - ALA Individual Sightings\",\"caption\":\"Egretta picata. Image by Clare Pearce - ALA Individual Sightings\",\"parent\":38260,\"mime_type\":\"image\\/png\",\"images\":{\"full\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3.png\",\"width\":441,\"height\":441},\"thumbnail\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3-150x150.png\",\"width\":150,\"height\":150},\"medium\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3-300x300.png\",\"width\":300,\"height\":300},\"medium_large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3.png\",\"width\":441,\"height\":441},\"large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.3.png\",\"width\":441,\"height\":441}}},{\"id\":38265,\"url\":\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4.png\",\"slug\":\"jul173-4\",\"title\":\"jul17(3.4)\",\"description\":\"Nymphaea violacea. Image by Clare Pearce - ALA Individual Sightings\",\"caption\":\"Nymphaea violacea. Image by Clare Pearce - ALA Individual Sightings\",\"parent\":38260,\"mime_type\":\"image\\/png\",\"images\":{\"full\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4.png\",\"width\":485,\"height\":481},\"thumbnail\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4-150x150.png\",\"width\":150,\"height\":150},\"medium\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4-300x298.png\",\"width\":300,\"height\":298},\"medium_large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4.png\",\"width\":485,\"height\":481},\"large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/jul173.4.png\",\"width\":485,\"height\":481}}}],\"comment_count\":0,\"comment_status\":\"closed\",\"custom_fields\":{}}]}"
        def json2 = "{\"status\":\"ok\",\"count\":1,\"pages\":279,\"category\":{\"id\":2,\"slug\":\"blogs-news\",\"title\":\"Blogs &amp; news\",\"description\":\"\",\"parent\":0,\"post_count\":279},\"posts\":{\"id\":38294,\"type\":\"post\",\"slug\":\"join-the-worlds-biggest-fish-race-around-the-world\",\"url\":\"https:\\/\\/www.ala.org.au\\/blogs-news\\/join-the-worlds-biggest-fish-race-around-the-world\\/\",\"status\":\"publish\",\"title\":\"Join the world\\u2019s biggest fish race around the world\",\"title_plain\":\"Join the world\\u2019s biggest fish race around the world\",\"content\":\"<p>It\\u2019s National Science Week this week, and there\\u2019s lots of things to get involved in, including the Whale Shark Race Around the World. The Race which officially kicked off yesterday, will see schools around the country join scientists in tracking the movements of the world\\u2019s biggest fish &#8211; the Whale Shark.<\\/p><p>ECOCEAN is Australia\\u2019s only not-for-profit research organisation dedicated to conserving the whale shark. As well as expanding our knowledge of whale shark movements and distribution in the south-eastern Indian Ocean, their research has also expanded the learning opportunities for Western Australian school students through the Whale Shark Race Around the World.<\\/p><div id=\\\"attachment_38298\\\" style=\\\"width: 1034px\\\" class=\\\"wp-caption aligncenter\\\"><img width=\\\"1024\\\" height=\\\"768\\\" class=\\\"size-large wp-image-38298\\\" alt=\\\"\\\" src=\\\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-1024x768.jpg\\\" srcset=\\\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-1024x768.jpg 1024w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-300x225.jpg 300w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-768x576.jpg 768w\\\" sizes=\\\"(max-width: 1024px) 100vw, 1024px\\\" \\/><p class=\\\"wp-caption-text\\\">The Whale Shark Race Around the World kicked off on 14th August 2017 just in time for National Science Week. Image credit: ECOCEAN<\\/p><\\/div><p>&nbsp;<\\/p><p>The Whale Shark Race Around the World started in 2015 with schools around Western Australia sponsoring satellite tags that were deployed on whale sharks at Ningaloo Reef, Western Australia. The Race is a joint ECOCEAN-Department of Education program designed to inspire students in science, technology, engineering and maths (STEM) learning. The tracks of the tagged sharks are available for anyone to see on ALA\\u2019s Zoatrack (<a href=\\\"http:\\/\\/www.zoatrack.org\\/\\\">www.zoatrack.org<\\/a>) platform, so students are able to follow the movements of their sharks. Samantha Reynolds is one of the lead researchers for the project, and she said, \\u201cWe bring real-world scientific research directly into the classroom and use the world\\u2019s biggest fish to get kids excited about science and marine conservation\\u201d.<\\/p><p>For this year\\u2019s race, teachers and students will be able to use ZoaTrack visualisation and analysis tools in their lessons and will have access to the ongoing tracking of the sharks. Involvement in the race will support students and teachers to further develop their STEM capabilities, including: critical analysis and creative thinking, deepen their knowledge and understanding of the whale shark, the marine environment of Western Australia and scientific research. Teaching and learning resources developed by the Department of Education are designed to support teachers and students to engage in innovative and interactive STEM learning activities.<\\/p><p>Tagging of whale sharks for the 2017 Race Around the World has been happening over the past few weeks, and researchers have been tagging large, mature whale sharks, hoping to gain insights into where they go to breed. \\u201cWe\\u2019d like to find some clues to where whale sharks go to find love\\u201d, said Ms Reynolds, \\u201cbecause despite being the biggest fish in the sea, we still don\\u2019t know where they mate or give birth\\u201d she explained.<\\/p><div id=\\\"attachment_38297\\\" style=\\\"width: 1034px\\\" class=\\\"wp-caption aligncenter\\\"><img width=\\\"1024\\\" height=\\\"646\\\" class=\\\"size-large wp-image-38297\\\" alt=\\\"\\\" src=\\\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-1024x646.jpg\\\" srcset=\\\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-1024x646.jpg 1024w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-300x189.jpg 300w, https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-768x485.jpg 768w\\\" sizes=\\\"(max-width: 1024px) 100vw, 1024px\\\" \\/><p class=\\\"wp-caption-text\\\">Samantha Reynolds photographing a Whale Shark. Image credit: Janine Marx.<\\/p><\\/div><p>&nbsp;<\\/p><p>You can take a look at the tracks of the tagged whale sharks which is being updated daily at (<a href=\\\"https:\\/\\/zoatrack.org\\/whalesharkrace\\\">https:\\/\\/zoatrack.org\\/whalesharkrace<\\/a>).<\\/p><p><strong>About ECOCEAN (www.whaleshark.org.au)<\\/strong><\\/p><p>ECOCEAN is Australia\\u2019s only not-for-profit research organisation dedicated to conserving the world\\u2019s biggest fish, the whale shark. ECOCEAN scientists have been working on whale sharks at Ningaloo Reef since 1995 and have contributed to the global protection of whale sharks through reports to the IUCN Red List of Threatened Species and the United Nations Convention on International Trade in Endangered Species (CITES). ECOCEAN also promotes conservation of whale sharks and the marine environment by engaging members of the public in its pioneering \\u201ccitizen science\\u201d projects. ECOCEAN was instrumental in setting up the world\\u2019s largest whale shark photo-identification library, now called the Wildbook for Whale Sharks, which encourages members of the public to get involved in whale shark research by submitting their photos online. The library currently has over 8000 individually identified whale sharks from over 50 countries around the world. And an innovative new program by ECOCEAN is engaging the next generation of scientists by involving school children in the satellite-tracking of whale sharks, connecting them to real-world scientific research and inspiring them to protect and conserve our precious marine environment and its inhabitants.<\\/p><p>For more information about ECOCEAN or about the Whale Shark Race Around the World, please contact Samantha Reynolds at <a href=\\\"mailto:samantha.reynolds1@uq.net.au\\\">mailto:samantha.reynolds1@uq.net.au<\\/a>\\u00a0or 0424563472. For more information about ZoaTrack please visit the website (<a href=\\\"https:\\/\\/zoatrack.org\\/\\\">https:\\/\\/zoatrack.org\\/<\\/a>).<\\/p>\",\"excerpt\":\"<p>It\\u2019s National Science Week this week, and there\\u2019s lots of things to get involved in, including the Whale Shark Race Around the World. The Race which officially kicked off yesterday, will see schools around the country join scientists in tracking the movements of the world\\u2019s biggest fish &#8211; the Whale Shark.ECOCEAN is Australia\\u2019s only not-for-profit [&hellip;]<\\/p>\\n\",\"date\":\"2017-08-15 16:40:07\",\"modified\":\"2017-08-15 16:43:34\",\"categories\":[{\"id\":2,\"slug\":\"blogs-news\",\"title\":\"Blogs &amp; news\",\"description\":\"\",\"parent\":0,\"post_count\":279}],\"tags\":[],\"author\":{\"id\":31,\"slug\":\"hannah-scottcsiro-au\",\"name\":\"Hannah Scott\",\"first_name\":\"Hannah\",\"last_name\":\"Scott\",\"nickname\":\"Hannah.Scott@csiro.au\",\"url\":\"\",\"description\":\"\"},\"comments\":[],\"attachments\":[{\"id\":38297,\"url\":\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx.jpg\",\"slug\":\"sreynolds_photographs_shark_copyright_janine_marx\",\"title\":\"SReynolds_photographs_shark_copyright_Janine_Marx\",\"description\":\"\",\"caption\":\"Samantha Reynolds photographing a Whale Shark.  Image credit: Janine Marx. \",\"parent\":38294,\"mime_type\":\"image\\/jpeg\",\"images\":{\"full\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx.jpg\",\"width\":3261,\"height\":2058},\"thumbnail\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-150x150.jpg\",\"width\":150,\"height\":150},\"medium\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-300x189.jpg\",\"width\":300,\"height\":189},\"medium_large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-768x485.jpg\",\"width\":768,\"height\":485},\"large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/SReynolds_photographs_shark_copyright_Janine_Marx-1024x646.jpg\",\"width\":1024,\"height\":646}}},{\"id\":38298,\"url\":\"http:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge.jpg\",\"slug\":\"olympus-digital-camera-3\",\"title\":\"OLYMPUS DIGITAL CAMERA\",\"description\":\"\",\"caption\":\"The Whale Shark Race Around the World kicked off on 14th August 2017 just in time for National Science Week.  Image credit: ECOCEAN\",\"parent\":38294,\"mime_type\":\"image\\/jpeg\",\"images\":{\"full\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge.jpg\",\"width\":1894,\"height\":1421},\"thumbnail\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-150x150.jpg\",\"width\":150,\"height\":150},\"medium\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-300x225.jpg\",\"width\":300,\"height\":225},\"medium_large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-768x576.jpg\",\"width\":768,\"height\":576},\"large\":{\"url\":\"https:\\/\\/www.ala.org.au\\/wp-content\\/uploads\\/2017\\/08\\/Swim3_30.7.15lge-1024x768.jpg\",\"width\":1024,\"height\":768}}}],\"comment_count\":0,\"comment_status\":\"closed\",\"custom_fields\":{}}]}"
        when:
        def check1 = diffService.hasChangedJsonDiff(json1, json1, query)
        then:
        check1 == false

        when:
        def check2 = diffService.hasChangedJsonDiff(json1, json2, query)
        then:
        check2 == true
    }

    void "test hasChangedJsonDiff for new records query"() {
        given:
        def query = Query.findByName("New records")
        def json1 = "{\"pageSize\":1,\"startIndex\":0,\"totalRecords\":2557,\"sort\":\"first_loaded_date\",\"dir\":\"desc\",\"status\":\"OK\",\"occurrences\":[{\"uuid\":\"afb2d66f-4d05-4561-8327-fdd55de318d1\",\"occurrenceID\":\"https://www.flickr.com/photos/126953422@N04/35969370594/\",\"taxonConceptID\":\"urn:lsid:biodiversity.org.au:afd.taxon:8e407974-a2d8-4ee0-a05f-5c956d6cfad8\",\"eventDate\":1503446400000,\"occurrenceYear\":1483228800000,\"scientificName\":\"Charadrius (Charadrius) ruficapillus\",\"vernacularName\":\"Red-capped Plover\",\"taxonRank\":\"species\",\"taxonRankID\":7000,\"country\":\"Australia\",\"kingdom\":\"Animalia\",\"phylum\":\"Chordata\",\"classs\":\"Aves\",\"order\":\"Charadriiformes\",\"family\":\"Charadriidae\",\"genus\":\"Charadrius\",\"genusGuid\":\"urn:lsid:biodiversity.org.au:afd.taxon:cce37714-ef08-4d55-8b34-5c34af9194e5\",\"species\":\"Charadrius ruficapillus\",\"speciesGuid\":\"urn:lsid:biodiversity.org.au:afd.taxon:8e407974-a2d8-4ee0-a05f-5c956d6cfad8\",\"stateProvince\":\"Queensland\",\"decimalLatitude\":-16.088887,\"decimalLongitude\":145.466623,\"coordinateUncertaintyInMeters\":15.0,\"year\":\"2017\",\"month\":\"08\",\"basisOfRecord\":\"Image\",\"left\":55737,\"right\":55737,\"lga\":\"Cairns (R)\",\"dataProviderUid\":\"dp29\",\"dataProviderName\":\"Flickr\",\"dataResourceUid\":\"dr360\",\"dataResourceName\":\"Encyclopedia of Life Images - Flickr Group\",\"assertions\":[\"assumedPresentOccurrenceStatus\",\"geodeticDatumAssumedWgs84\",\"habitatMismatch\"],\"speciesGroups\":[\"Animals\",\"Birds\"],\"image\":\"adfdd0d7-3f90-410d-90f5-a9fdeeb40957\",\"images\":[\"adfdd0d7-3f90-410d-90f5-a9fdeeb40957\"],\"geospatialKosher\":\"false\",\"taxonomicKosher\":\"true\",\"collector\":\"Graham Winterflood\",\"collectors\":[\"Winterflood, G. Graham\"],\"raw_scientificName\":\"Charadrius ruficapillus\",\"raw_basisOfRecord\":\"Image\",\"latLong\":\"-16.088887,145.466623\",\"point1\":\"-16,145\",\"point01\":\"-16.1,145.5\",\"point001\":\"-16.09,145.47\",\"point0001\":\"-16.089,145.467\",\"point00001\":\"-16.0889,145.4666\",\"namesLsid\":\"Charadrius (Charadrius) ruficapillus|urn:lsid:biodiversity.org.au:afd.taxon:8e407974-a2d8-4ee0-a05f-5c956d6cfad8|Red-capped Plover|Animalia|Charadriidae\",\"multimedia\":[\"Image\"],\"occurrenceDetails\":\"https://www.flickr.com/photos/126953422@N04/35969370594/\",\"miscIntProperties\":{\"occurrence_decade_i\":2010},\"imageUrl\":\"http://images.ala.org.au/image/proxyImage?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957\",\"largeImageUrl\":\"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957\",\"smallImageUrl\":\"http://images.ala.org.au/image/proxyImageThumbnail?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957\",\"thumbnailUrl\":\"http://images.ala.org.au/image/proxyImageThumbnail?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957\",\"imageUrls\":[\"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957\"]}],\"facetResults\":[],\"query\":\"?q=first_loaded_date%3A%5B2017-08-27T09%3A48%3A00Z+TO+*%5D\",\"urlParameters\":\"?q=first_loaded_date%3A%5B2017-08-27T09%3A48%3A00Z+TO+*%5D\",\"queryTitle\":\"Date first indexed:[2017-08-27T09:48:00Z TO *]\",\"activeFacetMap\":{}}"
        def json2 = "{\"pageSize\":1,\"startIndex\":0,\"totalRecords\":624,\"sort\":\"first_loaded_date\",\"dir\":\"desc\",\"status\":\"OK\",\"occurrences\":[{\"uuid\":\"77da1a0d-84c0-43a8-8ad9-3aa89e2b2672\",\"occurrenceID\":\"https://www.flickr.com/photos/126953422@N04/36019316063/\",\"taxonConceptID\":\"urn:lsid:biodiversity.org.au:afd.taxon:090ae627-3c3f-4883-be29-302b1891cdcd\",\"eventDate\":1497657600000,\"occurrenceYear\":1483228800000,\"scientificName\":\"Ardea (Typhon) sumatrana\",\"vernacularName\":\"Great-billed Heron\",\"taxonRank\":\"species\",\"taxonRankID\":7000,\"country\":\"Australia\",\"kingdom\":\"Animalia\",\"phylum\":\"Chordata\",\"classs\":\"Aves\",\"order\":\"Ciconiiformes\",\"family\":\"Ardeidae\",\"genus\":\"Ardea\",\"genusGuid\":\"urn:lsid:biodiversity.org.au:afd.taxon:adf1f806-e3f8-475c-a46c-744ee9a10767\",\"species\":\"Ardea sumatrana\",\"speciesGuid\":\"urn:lsid:biodiversity.org.au:afd.taxon:090ae627-3c3f-4883-be29-302b1891cdcd\",\"stateProvince\":\"Western Australia\",\"decimalLatitude\":-15.553177,\"decimalLongitude\":125.225343,\"coordinateUncertaintyInMeters\":14.0,\"year\":\"2017\",\"month\":\"06\",\"basisOfRecord\":\"Image\",\"left\":57163,\"right\":57163,\"dataProviderUid\":\"dp29\",\"dataProviderName\":\"Flickr\",\"dataResourceUid\":\"dr360\",\"dataResourceName\":\"Encyclopedia of Life Images - Flickr Group\",\"assertions\":[\"assumedPresentOccurrenceStatus\",\"geodeticDatumAssumedWgs84\",\"habitatMismatch\"],\"speciesGroups\":[\"Animals\",\"Birds\"],\"image\":\"d2f6e943-e147-4a85-b19f-3b94391f67a1\",\"images\":[\"d2f6e943-e147-4a85-b19f-3b94391f67a1\"],\"geospatialKosher\":\"false\",\"taxonomicKosher\":\"true\",\"collector\":\"Graham Winterflood\",\"collectors\":[\"Winterflood, G. Graham\"],\"raw_scientificName\":\"Ardea sumatrana\",\"raw_basisOfRecord\":\"Image\",\"latLong\":\"-15.553177,125.225343\",\"point1\":\"-16,125\",\"point01\":\"-15.6,125.2\",\"point001\":\"-15.55,125.23\",\"point0001\":\"-15.553,125.225\",\"point00001\":\"-15.5532,125.2253\",\"namesLsid\":\"Ardea (Typhon) sumatrana|urn:lsid:biodiversity.org.au:afd.taxon:090ae627-3c3f-4883-be29-302b1891cdcd|Great-billed Heron|Animalia|Ardeidae\",\"multimedia\":[\"Image\"],\"occurrenceDetails\":\"https://www.flickr.com/photos/126953422@N04/36019316063/\",\"miscIntProperties\":{\"occurrence_decade_i\":2010},\"imageUrl\":\"http://images.ala.org.au/image/proxyImage?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1\",\"largeImageUrl\":\"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1\",\"smallImageUrl\":\"http://images.ala.org.au/image/proxyImageThumbnail?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1\",\"thumbnailUrl\":\"http://images.ala.org.au/image/proxyImageThumbnail?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1\",\"imageUrls\":[\"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1\"]}],\"facetResults\":[],\"query\":\"?q=first_loaded_date%3A%5B2017-09-01T09%3A48%3A00Z+TO+*%5D\",\"urlParameters\":\"?q=first_loaded_date%3A%5B2017-09-01T09%3A48%3A00Z+TO+*%5D\",\"queryTitle\":\"Date first indexed:[2017-09-01T09:48:00Z TO *]\",\"activeFacetMap\":{}}"
        when:
        def check1 = diffService.hasChangedJsonDiff(json1, json1, query)
        then:
        check1 == false

        when:
        def check2 = diffService.hasChangedJsonDiff(json1, json2, query)
        then:
        check2 == true
    }
}
