/*
 * Copyright (C) 2017 Atlas of Living Australia
 * All Rights Reserved.
 * The contents of this file are subject to the Mozilla Public
 * License Version 1.1 (the "License"); you may not use this file
 * except in compliance with the License. You may obtain a copy of
 * the License at http://www.mozilla.org/MPL/
 * Software distributed under the License is distributed on an "AS
 * IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
 * implied. See the License for the specific language governing
 * rights and limitations under the License.
 */

package au.org.ala.alerts

import grails.test.mixin.integration.Integration
import grails.gorm.transactions.*
import org.springframework.beans.factory.annotation.Autowired
import spock.lang.*

@Integration
@Rollback
class DiffServiceSpec extends Specification {
    @Autowired
    DiffService diffService

    def setup() {
    }

    def cleanup() {
    }

    void "test hasChangedJsonDiff for blogs and news query"() {
        given:
        def query = Query.findByName("Blogs and News")
        def json1 = """
                [{"id":44308,"date":"2020-11-16T17:48:25","date_gmt":"2020-11-16T06:48:25","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44308"},"modified":"2020-11-16T17:48:33","modified_gmt":"2020-11-16T06:48:33","slug":"monday-corroboree-frog","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-corroboree-frog\/","title":{"rendered":"Monday Corroboree Frog"},"content":{"rendered":"\n<p>It&#8217;s still Monday, so here&#8217;s a Corroboree Frog.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"650\" height=\"617\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/corroboree-frog.jpeg\" alt=\"\" class=\"wp-image-44309\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/corroboree-frog.jpeg 650w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/corroboree-frog-300x285.jpeg 300w\" sizes=\"(max-width: 650px) 100vw, 650px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>This excerpt tells you everything you need to know about a corroboree frog at a glance.<\/p>\n","protected":false},"author":28,"featured_media":44178,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44308"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44308"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44308\/revisions"}],"predecessor-version":[{"id":44310,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44308\/revisions\/44310"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44178"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44308"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44308"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44308"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44304,"date":"2020-11-16T15:10:37","date_gmt":"2020-11-16T04:10:37","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44304"},"modified":"2020-11-16T15:10:46","modified_gmt":"2020-11-16T04:10:46","slug":"monday-fly-agaric","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-fly-agaric\/","title":{"rendered":"Monday Fly Agaric"},"content":{"rendered":"\n<p>It&#8217;s Monday, so here is a Fly Agaric (<em>Amanita muscaria<\/em>).<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"256\" height=\"256\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/muscaria-1.jpg\" alt=\"\" class=\"wp-image-44305\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/muscaria-1.jpg 256w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/muscaria-1-150x150.jpg 150w\" sizes=\"(max-width: 256px) 100vw, 256px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Excerpt text would go here if there was some excerpt text.<\/p>\n","protected":false},"author":28,"featured_media":44306,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44304"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44304"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44304\/revisions"}],"predecessor-version":[{"id":44307,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44304\/revisions\/44307"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44306"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44304"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44304"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44304"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44300,"date":"2020-11-16T12:14:33","date_gmt":"2020-11-16T01:14:33","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44300"},"modified":"2020-11-16T12:14:35","modified_gmt":"2020-11-16T01:14:35","slug":"monday-rainbow-lorikeet","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-rainbow-lorikeet\/","title":{"rendered":"Monday rainbow lorikeet"},"content":{"rendered":"\n<p>Here is your latest rainbow lorikeet, freshly hatched.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"650\" height=\"570\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/rainbow-lorikeet.jpeg\" alt=\"\" class=\"wp-image-44301\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/rainbow-lorikeet.jpeg 650w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/rainbow-lorikeet-300x263.jpeg 300w\" sizes=\"(max-width: 650px) 100vw, 650px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Excerpt text would go here if there was some excerpt text.<\/p>\n","protected":false},"author":28,"featured_media":44302,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44300"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44300"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44300\/revisions"}],"predecessor-version":[{"id":44303,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44300\/revisions\/44303"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44302"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44300"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44300"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44300"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44297,"date":"2020-11-16T10:56:08","date_gmt":"2020-11-15T23:56:08","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44297"},"modified":"2020-11-16T10:56:10","modified_gmt":"2020-11-15T23:56:10","slug":"monday-squid","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-squid\/","title":{"rendered":"Monday squid"},"content":{"rendered":"\n<p>It&#8217;s Monday, which means it&#8217;s a squid.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"300\" height=\"168\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/squid.jpeg\" alt=\"\" class=\"wp-image-44298\"\/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>This would be some excerpt text if someone could be bothered to write some excerpt text.<\/p>\n","protected":false},"author":28,"featured_media":44179,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44297"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44297"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44297\/revisions"}],"predecessor-version":[{"id":44299,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44297\/revisions\/44299"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44179"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44297"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44297"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44297"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44291,"date":"2020-11-10T12:59:54","date_gmt":"2020-11-10T01:59:54","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44291"},"modified":"2020-11-10T13:00:05","modified_gmt":"2020-11-10T02:00:05","slug":"in-news-just-to-hand-its-tuesday","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/in-news-just-to-hand-its-tuesday\/","title":{"rendered":"In news just to hand, it&#8217;s Tuesday."},"content":{"rendered":"\n<p>Please don&#8217;t be alarmed.  There is no emergency, but Tuesday has been announced.<\/p>\n\n\n\n<p>This image puts into context:<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"1024\" height=\"718\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/07\/jun2013.3-1024x718.png\" alt=\"\" class=\"wp-image-44169\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/07\/jun2013.3-1024x718.png 1024w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/07\/jun2013.3-300x210.png 300w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/07\/jun2013.3-768x539.png 768w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/07\/jun2013.3-1536x1077.png 1536w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/07\/jun2013.3.png 1688w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Experts warn that today might be Tuesday.<\/p>\n","protected":false},"author":28,"featured_media":44177,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44291"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44291"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44291\/revisions"}],"predecessor-version":[{"id":44292,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44291\/revisions\/44292"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44177"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44291"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44291"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44291"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}]
                """.stripIndent()
        def json2 = """
                [{"id":44312,"date":"2020-11-18T16:14:36","date_gmt":"2020-11-18T05:14:36","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44312"},"modified":"2020-11-18T16:14:39","modified_gmt":"2020-11-18T05:14:39","slug":"wednesday-climbing-fern","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/wednesday-climbing-fern\/","title":{"rendered":"Wednesday climbing fern"},"content":{"rendered":"\n<p>It&#8217;s Wednesday, so here&#8217;s a climbing fern.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"256\" height=\"256\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/climbing-fern.jpg\" alt=\"\" class=\"wp-image-44313\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/climbing-fern.jpg 256w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/climbing-fern-150x150.jpg 150w\" sizes=\"(max-width: 256px) 100vw, 256px\" \/><\/figure>\n\n\n\n<p>Have a nice day.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>It&#8217;s Wednesday, so you deserve a climbing fern.<\/p>\n","protected":false},"author":28,"featured_media":44313,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44312"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44312"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44312\/revisions"}],"predecessor-version":[{"id":44314,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44312\/revisions\/44314"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44313"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44312"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44312"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44312"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44308,"date":"2020-11-16T17:48:25","date_gmt":"2020-11-16T06:48:25","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44308"},"modified":"2020-11-16T17:48:33","modified_gmt":"2020-11-16T06:48:33","slug":"monday-corroboree-frog","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-corroboree-frog\/","title":{"rendered":"Monday Corroboree Frog"},"content":{"rendered":"\n<p>It&#8217;s still Monday, so here&#8217;s a Corroboree Frog.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"650\" height=\"617\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/corroboree-frog.jpeg\" alt=\"\" class=\"wp-image-44309\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/corroboree-frog.jpeg 650w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/corroboree-frog-300x285.jpeg 300w\" sizes=\"(max-width: 650px) 100vw, 650px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>This excerpt tells you everything you need to know about a corroboree frog at a glance.<\/p>\n","protected":false},"author":28,"featured_media":44178,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44308"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44308"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44308\/revisions"}],"predecessor-version":[{"id":44310,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44308\/revisions\/44310"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44178"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44308"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44308"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44308"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44304,"date":"2020-11-16T15:10:37","date_gmt":"2020-11-16T04:10:37","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44304"},"modified":"2020-11-16T15:10:46","modified_gmt":"2020-11-16T04:10:46","slug":"monday-fly-agaric","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-fly-agaric\/","title":{"rendered":"Monday Fly Agaric"},"content":{"rendered":"\n<p>It&#8217;s Monday, so here is a Fly Agaric (<em>Amanita muscaria<\/em>).<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"256\" height=\"256\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/muscaria-1.jpg\" alt=\"\" class=\"wp-image-44305\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/muscaria-1.jpg 256w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/muscaria-1-150x150.jpg 150w\" sizes=\"(max-width: 256px) 100vw, 256px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Excerpt text would go here if there was some excerpt text.<\/p>\n","protected":false},"author":28,"featured_media":44306,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44304"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44304"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44304\/revisions"}],"predecessor-version":[{"id":44307,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44304\/revisions\/44307"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44306"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44304"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44304"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44304"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44300,"date":"2020-11-16T12:14:33","date_gmt":"2020-11-16T01:14:33","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44300"},"modified":"2020-11-16T12:14:35","modified_gmt":"2020-11-16T01:14:35","slug":"monday-rainbow-lorikeet","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-rainbow-lorikeet\/","title":{"rendered":"Monday rainbow lorikeet"},"content":{"rendered":"\n<p>Here is your latest rainbow lorikeet, freshly hatched.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"650\" height=\"570\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/rainbow-lorikeet.jpeg\" alt=\"\" class=\"wp-image-44301\" srcset=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/rainbow-lorikeet.jpeg 650w, https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/rainbow-lorikeet-300x263.jpeg 300w\" sizes=\"(max-width: 650px) 100vw, 650px\" \/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Excerpt text would go here if there was some excerpt text.<\/p>\n","protected":false},"author":28,"featured_media":44302,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44300"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44300"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44300\/revisions"}],"predecessor-version":[{"id":44303,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44300\/revisions\/44303"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44302"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44300"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44300"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44300"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}},{"id":44297,"date":"2020-11-16T10:56:08","date_gmt":"2020-11-15T23:56:08","guid":{"rendered":"https:\/\/www-test.ala.org.au\/?p=44297"},"modified":"2020-11-16T10:56:10","modified_gmt":"2020-11-15T23:56:10","slug":"monday-squid","status":"publish","type":"post","link":"https:\/\/www-test.ala.org.au\/blogs-news\/monday-squid\/","title":{"rendered":"Monday squid"},"content":{"rendered":"\n<p>It&#8217;s Monday, which means it&#8217;s a squid.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" width=\"300\" height=\"168\" src=\"https:\/\/www-test.ala.org.au\/app\/uploads\/2020\/11\/squid.jpeg\" alt=\"\" class=\"wp-image-44298\"\/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>This would be some excerpt text if someone could be bothered to write some excerpt text.<\/p>\n","protected":false},"author":28,"featured_media":44179,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44297"}],"collection":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/users\/28"}],"replies":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/comments?post=44297"}],"version-history":[{"count":1,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44297\/revisions"}],"predecessor-version":[{"id":44299,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/posts\/44297\/revisions\/44299"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media\/44179"}],"wp:attachment":[{"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/media?parent=44297"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/categories?post=44297"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www-test.ala.org.au\/wp-json\/wp\/v2\/tags?post=44297"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}]
                """.stripIndent()

        when:
        def check1 = diffService.hasChangedJsonDiff(json1, json1, query, true)
        then:
        check1 == false

        when:
        def check2 = diffService.hasChangedJsonDiff(json1, json2, query, true)
        then:
        check2 == true
    }

    void "test hasChangedJsonDiff for new records query"() {
        given:
        def query = Query.findByName("New records")
        def json1 = """
                {"pageSize":2,"startIndex":0,"totalRecords":624,"sort":"first_loaded_date","dir":"desc","status":"OK","occurrences":[{"uuid":"77da1a0d-84c0-43a8-8ad9-3aa89e2b2672","occurrenceID":"https://www.flickr.com/photos/126953422@N04/36019316063/","taxonConceptID":"urn:lsid:biodiversity.org.au:afd.taxon:090ae627-3c3f-4883-be29-302b1891cdcd","eventDate":1497657600000,"occurrenceYear":1483228800000,"scientificName":"Ardea (Typhon) sumatrana","vernacularName":"Great-billed Heron","taxonRank":"species","taxonRankID":7000,"country":"Australia","kingdom":"Animalia","phylum":"Chordata","classs":"Aves","order":"Ciconiiformes","family":"Ardeidae","genus":"Ardea","genusGuid":"urn:lsid:biodiversity.org.au:afd.taxon:adf1f806-e3f8-475c-a46c-744ee9a10767","species":"Ardea sumatrana","speciesGuid":"urn:lsid:biodiversity.org.au:afd.taxon:090ae627-3c3f-4883-be29-302b1891cdcd","stateProvince":"Western Australia","decimalLatitude":-15.553177,"decimalLongitude":125.225343,"coordinateUncertaintyInMeters":14,"year":"2017","month":"06","basisOfRecord":"Image","left":57163,"right":57163,"dataProviderUid":"dp29","dataProviderName":"Flickr","dataResourceUid":"dr360","dataResourceName":"Encyclopedia of Life Images - Flickr Group","assertions":["assumedPresentOccurrenceStatus","geodeticDatumAssumedWgs84","habitatMismatch"],"speciesGroups":["Animals","Birds"],"image":"d2f6e943-e147-4a85-b19f-3b94391f67a1","images":["d2f6e943-e147-4a85-b19f-3b94391f67a1"],"geospatialKosher":"false","taxonomicKosher":"true","collector":"Graham Winterflood","collectors":["Winterflood, G. Graham"],"raw_scientificName":"Ardea sumatrana","raw_basisOfRecord":"Image","latLong":"-15.553177,125.225343","point1":"-16,125","point01":"-15.6,125.2","point001":"-15.55,125.23","point0001":"-15.553,125.225","point00001":"-15.5532,125.2253","namesLsid":"Ardea (Typhon) sumatrana|urn:lsid:biodiversity.org.au:afd.taxon:090ae627-3c3f-4883-be29-302b1891cdcd|Great-billed Heron|Animalia|Ardeidae","multimedia":["Image"],"occurrenceDetails":"https://www.flickr.com/photos/126953422@N04/36019316063/","miscIntProperties":{"occurrence_decade_i":2010},"imageUrl":"http://images.ala.org.au/image/proxyImage?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1","largeImageUrl":"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1","smallImageUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1","thumbnailUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1","imageUrls":["http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=d2f6e943-e147-4a85-b19f-3b94391f67a1"]},{"uuid":"f01368a0-16ff-41b0-bf8d-2ded73fe884c","occurrenceID":"https://www.flickr.com/photos/126953422@N04/36115339414/","taxonConceptID":"urn:lsid:biodiversity.org.au:afd.taxon:7fa1974f-c976-4ec7-9bdf-35b2f962982d","eventDate":1454284800000,"occurrenceYear":1451606400000,"scientificName":"Rhyothemis resplendens","taxonRank":"species","taxonRankID":7000,"country":"Australia","kingdom":"Animalia","phylum":"Arthropoda","classs":"Insecta","order":"Odonata","family":"Libellulidae","genus":"Rhyothemis","genusGuid":"urn:lsid:biodiversity.org.au:afd.taxon:871da67c-2d56-40a1-8ede-59bd5367a327","species":"Rhyothemis resplendens","speciesGuid":"urn:lsid:biodiversity.org.au:afd.taxon:7fa1974f-c976-4ec7-9bdf-35b2f962982d","stateProvince":"Queensland","decimalLatitude":-16.903411,"decimalLongitude":145.749295,"coordinateUncertaintyInMeters":16,"year":"2016","month":"02","basisOfRecord":"Image","left":153155,"right":153155,"lga":"Cairns (R)","dataProviderUid":"dp29","dataProviderName":"Flickr","dataResourceUid":"dr360","dataResourceName":"Encyclopedia of Life Images - Flickr Group","assertions":["firstOfMonth","assumedPresentOccurrenceStatus","geodeticDatumAssumedWgs84"],"speciesGroups":["Animals","Arthropods","Insects"],"image":"f94270dd-3d17-4ead-990d-520a36d6ce39","images":["f94270dd-3d17-4ead-990d-520a36d6ce39"],"geospatialKosher":"true","taxonomicKosher":"true","collector":"Graham Winterflood","collectors":["Winterflood, G. Graham"],"raw_scientificName":"Rhyothemis resplendens","raw_basisOfRecord":"Image","latLong":"-16.903411,145.749295","point1":"-17,146","point01":"-16.9,145.7","point001":"-16.9,145.75","point0001":"-16.903,145.749","point00001":"-16.9034,145.7493","namesLsid":"Rhyothemis resplendens|urn:lsid:biodiversity.org.au:afd.taxon:7fa1974f-c976-4ec7-9bdf-35b2f962982d||Animalia|Libellulidae","multimedia":["Image"],"occurrenceDetails":"https://www.flickr.com/photos/126953422@N04/36115339414/","miscIntProperties":{"occurrence_decade_i":2010},"imageUrl":"http://images.ala.org.au/image/proxyImage?imageId=f94270dd-3d17-4ead-990d-520a36d6ce39","largeImageUrl":"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=f94270dd-3d17-4ead-990d-520a36d6ce39","smallImageUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=f94270dd-3d17-4ead-990d-520a36d6ce39","thumbnailUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=f94270dd-3d17-4ead-990d-520a36d6ce39","imageUrls":["http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=f94270dd-3d17-4ead-990d-520a36d6ce39"]}],"facetResults":[{"fieldName":"basis_of_record","fieldResult":[{"label":"HumanObservation","count":538,"fq":"basis_of_record:\\"HumanObservation\\""},{"label":"Image","count":86,"fq":"basis_of_record:\\"Image\\""}]}],"query":"?q=first_loaded_date%3A%5B2017-09-01T09%3A48%3A00Z+TO+*%5D","urlParameters":"?q=first_loaded_date%3A%5B2017-09-01T09%3A48%3A00Z+TO+*%5D","queryTitle":"Date first indexed:[2017-09-01T09:48:00Z TO *]","activeFacetMap":{}}
                """.stripIndent()
        def json2 = """
                {"pageSize":2,"startIndex":0,"totalRecords":624,"sort":"first_loaded_date","dir":"desc","status":"OK","occurrences":[{"uuid":"afb2d66f-4d05-4561-8327-fdd55de318d1","occurrenceID":"https://www.flickr.com/photos/126953422@N04/35969370594/","taxonConceptID":"urn:lsid:biodiversity.org.au:afd.taxon:8e407974-a2d8-4ee0-a05f-5c956d6cfad8","eventDate":1503446400000,"occurrenceYear":1483228800000,"scientificName":"Charadrius (Charadrius) ruficapillus","vernacularName":"Red-capped Plover","taxonRank":"species","taxonRankID":7000,"country":"Australia","kingdom":"Animalia","phylum":"Chordata","classs":"Aves","order":"Charadriiformes","family":"Charadriidae","genus":"Charadrius","genusGuid":"urn:lsid:biodiversity.org.au:afd.taxon:cce37714-ef08-4d55-8b34-5c34af9194e5","species":"Charadrius ruficapillus","speciesGuid":"urn:lsid:biodiversity.org.au:afd.taxon:8e407974-a2d8-4ee0-a05f-5c956d6cfad8","stateProvince":"Queensland","decimalLatitude":-16.088887,"decimalLongitude":145.466623,"coordinateUncertaintyInMeters":15,"year":"2017","month":"08","basisOfRecord":"Image","left":55737,"right":55737,"lga":"Cairns (R)","dataProviderUid":"dp29","dataProviderName":"Flickr","dataResourceUid":"dr360","dataResourceName":"Encyclopedia of Life Images - Flickr Group","assertions":["assumedPresentOccurrenceStatus","geodeticDatumAssumedWgs84","habitatMismatch"],"speciesGroups":["Animals","Birds"],"image":"adfdd0d7-3f90-410d-90f5-a9fdeeb40957","images":["adfdd0d7-3f90-410d-90f5-a9fdeeb40957"],"geospatialKosher":"false","taxonomicKosher":"true","collector":"Graham Winterflood","collectors":["Winterflood, G. Graham"],"raw_scientificName":"Charadrius ruficapillus","raw_basisOfRecord":"Image","latLong":"-16.088887,145.466623","point1":"-16,145","point01":"-16.1,145.5","point001":"-16.09,145.47","point0001":"-16.089,145.467","point00001":"-16.0889,145.4666","namesLsid":"Charadrius (Charadrius) ruficapillus|urn:lsid:biodiversity.org.au:afd.taxon:8e407974-a2d8-4ee0-a05f-5c956d6cfad8|Red-capped Plover|Animalia|Charadriidae","multimedia":["Image"],"occurrenceDetails":"https://www.flickr.com/photos/126953422@N04/35969370594/","miscIntProperties":{"occurrence_decade_i":2010},"imageUrl":"http://images.ala.org.au/image/proxyImage?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957","largeImageUrl":"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957","smallImageUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957","thumbnailUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957","imageUrls":["http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=adfdd0d7-3f90-410d-90f5-a9fdeeb40957"]},{"uuid":"3d88bf25-ec0c-4768-9157-586c68b60f5c","occurrenceID":"https://www.flickr.com/photos/126953422@N04/36021608784/","taxonConceptID":"urn:lsid:biodiversity.org.au:afd.taxon:b8743788-9d12-4be1-8c96-932ac9e5580b","eventDate":1500249600000,"occurrenceYear":1483228800000,"scientificName":"Petroica (Petroica) goodenovii","vernacularName":"Red-capped Robin","taxonRank":"species","taxonRankID":7000,"country":"Australia","kingdom":"Animalia","phylum":"Chordata","classs":"Aves","order":"Passeriformes","family":"Petroicidae","genus":"Petroica","genusGuid":"urn:lsid:biodiversity.org.au:afd.taxon:c611b1a0-957c-4011-af07-46cccd9136e1","species":"Petroica goodenovii","speciesGuid":"urn:lsid:biodiversity.org.au:afd.taxon:b8743788-9d12-4be1-8c96-932ac9e5580b","stateProvince":"Queensland","decimalLatitude":-25.900614,"decimalLongitude":139.355263,"coordinateUncertaintyInMeters":14,"year":"2017","month":"07","basisOfRecord":"Image","left":53039,"right":53039,"lga":"Diamantina (S)","dataProviderUid":"dp29","dataProviderName":"Flickr","dataResourceUid":"dr360","dataResourceName":"Encyclopedia of Life Images - Flickr Group","assertions":["assumedPresentOccurrenceStatus","geodeticDatumAssumedWgs84"],"speciesGroups":["Animals","Birds"],"image":"4d910eb7-78a7-43ad-9e90-b33569278015","images":["4d910eb7-78a7-43ad-9e90-b33569278015"],"geospatialKosher":"true","taxonomicKosher":"true","collector":"Graham Winterflood","collectors":["Winterflood, G. Graham"],"raw_scientificName":"Petroica goodenovii","raw_basisOfRecord":"Image","latLong":"-25.900614,139.355263","point1":"-26,139","point01":"-25.9,139.4","point001":"-25.9,139.36","point0001":"-25.901,139.355","point00001":"-25.9006,139.3553","namesLsid":"Petroica (Petroica) goodenovii|urn:lsid:biodiversity.org.au:afd.taxon:b8743788-9d12-4be1-8c96-932ac9e5580b|Red-capped Robin|Animalia|Petroicidae","multimedia":["Image"],"occurrenceDetails":"https://www.flickr.com/photos/126953422@N04/36021608784/","miscIntProperties":{"occurrence_decade_i":2010},"imageUrl":"http://images.ala.org.au/image/proxyImage?imageId=4d910eb7-78a7-43ad-9e90-b33569278015","largeImageUrl":"http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=4d910eb7-78a7-43ad-9e90-b33569278015","smallImageUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=4d910eb7-78a7-43ad-9e90-b33569278015","thumbnailUrl":"http://images.ala.org.au/image/proxyImageThumbnail?imageId=4d910eb7-78a7-43ad-9e90-b33569278015","imageUrls":["http://images.ala.org.au/image/proxyImageThumbnailLarge?imageId=4d910eb7-78a7-43ad-9e90-b33569278015"]}],"facetResults":[{"fieldName":"basis_of_record","fieldResult":[{"label":"HumanObservation","count":538,"fq":"basis_of_record:\\"HumanObservation\\""},{"label":"Image","count":86,"fq":"basis_of_record:\\"Image\\""}]}],"query":"?q=first_loaded_date%3A%5B2017-09-01T09%3A48%3A00Z+TO+*%5D","urlParameters":"?q=first_loaded_date%3A%5B2017-09-01T09%3A48%3A00Z+TO+*%5D","queryTitle":"Date first indexed:[2017-09-01T09:48:00Z TO *]","activeFacetMap":{}}
                """.stripIndent()
        when:
        def check1 = diffService.hasChangedJsonDiff(json1, json1, query, true)
        then:
        check1 == false

        when:
        def check2 = diffService.hasChangedJsonDiff(json1, json2, query, true)
        then:
        check2 == true
    }

    void "test hasChangedJsonDiff for Datasets query"() {
        given:
        def query = Query.findByName("Datasets")
        def json1 = "[{\"name\":\"cxcx\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr5053\",\"uid\":\"dr5053\"},{\"name\":\" Warringah Species List\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr4047\",\"uid\":\"dr4047\"},{\"name\":\"1 Quantitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2615\",\"uid\":\"dr2615\"},{\"name\":\"2 qualitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2616\",\"uid\":\"dr2616\"},{\"name\":\"20 Best Euclid characters\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2585\",\"uid\":\"dr2585\"},{\"name\":\"2016 Avifauna of Wallaroo\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr6693\",\"uid\":\"dr6693\"},{\"name\":\"2WEL-01\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2182\",\"uid\":\"dr2182\"},{\"name\":\"3 Acacia Qualitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2617\",\"uid\":\"dr2617\"},{\"name\":\"3 tree frogs\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr6785\",\"uid\":\"dr6785\"}]"
        def json2 = "[{\"name\":\"Warringah Species List\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr4047\",\"uid\":\"dr4047\"},{\"name\":\"1 Quantitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2615\",\"uid\":\"dr2615\"},{\"name\":\"2 qualitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2616\",\"uid\":\"dr2616\"},{\"name\":\"20 Best Euclid characters\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2585\",\"uid\":\"dr2585\"},{\"name\":\"2016 Avifauna of Wallaroo\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr6693\",\"uid\":\"dr6693\"},{\"name\":\"2WEL-01\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2182\",\"uid\":\"dr2182\"},{\"name\":\"3 Acacia Qualitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2617\",\"uid\":\"dr2617\"},{\"name\":\"3 tree frogs\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr6785\",\"uid\":\"dr6785\"},{\"name\":\"3AusMimulus\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2456\",\"uid\":\"dr2456\"},{\"name\":\"4 Quantitative\",\"uri\":\"http://collections.ala.org.au/ws/dataResource/dr2618\",\"uid\":\"dr2618\"}]"

        when:
        def check1 = diffService.hasChangedJsonDiff(json1, json1, query, true)
        then:
        check1 == false

        when:
        def check2 = diffService.hasChangedJsonDiff(json1, json2, query, true)
        then:
        check2 == true
    }

    void "test hasChangedJsonDiff for Spatial layers query"() {
        given:
        def query = Query.findByName("Spatial layers")
        def json1 = "[{\"displayname\":\"NVIS 4.1 Major Vegetation Groups\",\"enabled\":true,\"uid\":\"2125\",\"metadatapath\":\"http://www.environment.gov.au/fed/catalog/search/resource/details.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"classification1\":\"Vegetation\",\"classification2\":\"Classification\",\"notes\":\"\",\"source_link\":\"http://www.environment.gov.au/fed/catalog/search/resource/downloadData.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"licence_link\":\"http://www.environment.gov.au/fed/catalog/search/resource/details.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"licence_notes\":\"Separate State/Territory acknowledgement required on citation\",\"maxlatitude\":-8.13987,\"minlatitude\":-44.31837,\"minlongitude\":109.50436,\"maxlongitude\":157.21622,\"pid\":\"\",\"shape\":true,\"path_orig\":\"shape_diva/nvis41_mvg\",\"environmentalvalueunits\":\"\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:nvis41_mvg&format=image/png&styles=\",\"domain\":\"Terrestrial\",\"dt_added\":1448542800000,\"environmentalvaluemax\":\"\",\"environmentalvaluemin\":\"\",\"lookuptablepath\":\"\",\"citation_date\":\"11/2012\",\"datalang\":\"\",\"licence_level\":\"2\",\"mddatest\":\"\",\"mdhrlv\":\"\",\"respparty_role\":\"custodian\",\"keywords\":\"dominant, tree, forest, woodland, canopy, understory\",\"path_1km\":\"\",\"scale\":\"\",\"description\":\"Major Vegetation Groups were identified to summarise the type and distribution of Australia's native vegetation. The classification contains different mixes of plant species within the canopy, shrub or ground layers, but are structurally similar and are often dominated by a single genus. In a mapping sense, the groups reflect the dominant vegetation occurring in a map unit where there are a mix of several vegetation types. Subdominant vegetation groups which may also be present in the map unit are not shown. For example, the dominant vegetation in an area may be mapped as dominated by eucalypt open forest, although it contains pockets of rainforest, shrubland and grassland vegetation as subdominants.\",\"source\":\"http://www.environment.gov.au/fed/catalog/search/resource/details.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"name\":\"nvis41_mvg\",\"id\":2125,\"type\":\"Contextual\",\"path\":\"/data/ala/data/layers/ready/shape_diva\"},{\"displayname\":\"Occurrence Density\",\"enabled\":true,\"uid\":\"898\",\"metadatapath\":\"http://www.ala.org.au/\",\"classification1\":\"Biodiversity\",\"classification2\":\"\",\"notes\":\"Occurrence Density is derived by applying a moving average to all point occurrences held by the Atlas of Living Australia. If all occurrences are mapped (over terrestrial and marine areas), a moving average is like moving a window with many panes over the area, noting the number of occurrences in each pane and placing the average of all panes at the centre pane. The window is moved to the next sample location and the process repeated. Occurrence density uses a 9 by 9 pane window where each pane is 0.01 degrees latitude/longitude. Each move of the window is 0.01 degrees.\\r\\n\\r\\nScope: World\",\"source_link\":\"\",\"licence_link\":\"\",\"licence_notes\":\"\",\"maxlatitude\":-10.46623,\"minlatitude\":-36.41364,\"minlongitude\":96.79992,\"maxlongitude\":159.23333,\"pid\":\"\",\"grid\":true,\"path_orig\":\"diva/odensity\",\"environmentalvalueunits\":\"frequency\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:odensity&format=image/png&styles=\",\"domain\":\"Terrestrial, Marine\",\"dt_added\":1439388000000,\"environmentalvaluemax\":\"446649\",\"environmentalvaluemin\":\"0\",\"lookuptablepath\":\"\",\"citation_date\":\"\",\"datalang\":\"\",\"licence_level\":\"0\",\"mddatest\":\"\",\"mdhrlv\":\"\",\"respparty_role\":\"\",\"keywords\":\"average, sample\",\"path_1km\":\"\",\"scale\":\"0.01 degree (~1km)\",\"description\":\"Occurrence Density\",\"source\":\"ALA-SPATIAL\",\"name\":\"odensity\",\"id\":898,\"type\":\"Environmental\",\"path\":\"/data/ala/data/source/occurrence_layers/layer_occurrence_av_1.tif\"},{\"displayname\":\"Species Richness\",\"enabled\":true,\"uid\":\"899\",\"metadatapath\":\"http://www.ala.org.au/\",\"classification1\":\"Biodiversity\",\"classification2\":\"\",\"notes\":\"Species Richness is derived by applying a moving average to all point occurrences held by the Atlas of Living Australia. If all occurrences are mapped (over terrestrial and marine areas), a moving average is like moving a window with many panes over the area, noting the number of differences species in each pane and placing the average of all panes at the centre pane. The window is moved to the next sample location and the process repeated. Species Richness uses a 9 by 9 pane window where each pane is 0.01 degrees latitude/longitude. Each move of the window is 0.01 degrees.\\r\\n\\r\\nScope: World\",\"source_link\":\"\",\"licence_link\":\"\",\"licence_notes\":\"\",\"maxlatitude\":-9.0,\"minlatitude\":-43.8,\"minlongitude\":112.9,\"maxlongitude\":153.64,\"pid\":\"\",\"grid\":true,\"path_orig\":\"diva/srichness\",\"environmentalvalueunits\":\"frequency\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:srichness&format=image/png&styles=\",\"domain\":\"Terrestrial, Marine\",\"dt_added\":1439301600000,\"environmentalvaluemax\":\"7791\",\"environmentalvaluemin\":\"0\",\"lookuptablepath\":\"\",\"citation_date\":\"\",\"datalang\":\"\",\"licence_level\":\"0\",\"mddatest\":\"\",\"mdhrlv\":\"\",\"respparty_role\":\"\",\"keywords\":\"diversity, occurrence, sample, average\",\"path_1km\":\"\",\"scale\":\"0.01 degree (~1km)\",\"description\":\"Species Richness\",\"source\":\"ALA-SPATIAL\",\"name\":\"srichness\",\"id\":899,\"type\":\"Environmental\",\"path\":\"/data/ala/data/source/occurrence_layers/layer_species_av_1.tif\"}]"
        def json2 = "[{\"displayname\":\"Vegetation types - present\",\"enabled\":true,\"uid\":\"620\",\"metadatapath\":\"http://www.environment.gov.au/erin/nvis/mvg/index.html , http://www.environment.gov.au/erin/nvis/publications/pubs/major-veg-summary.pdf\",\"classification1\":\"Vegetation\",\"classification2\":\"\",\"notes\":\"Primary data with some data gaps filling from Major Vegetation Groups\",\"source_link\":\"http://data.daff.gov.au/anrdl/metadata_files/pa_vast_g9abll0032008_11a.xml\",\"licence_link\":\"http://data.daff.gov.au/anrdl/metadata_files/pa_vast_g9abll0032008_11a.xml\",\"licence_notes\":\"All material in this publication is licensed under a Creative Commons Attribution 3.0 Australia Licence, save for content supplied by third parties, logos and the Commonwealth Coat of Arms. This publication (and any material sourced from it) should be attributed as: Source: ABARES. Users of the data set are asked to acknowledge, in any visual or published material, that it was derived and compiled by ABARES. Users of the data set are asked to make known to ABARES any errors, omissions or suggestions for improvement.\",\"maxlatitude\":-9.22397,\"minlatitude\":-43.67225,\"minlongitude\":112.91646,\"maxlongitude\":153.6377,\"pid\":\"\",\"shape\":true,\"path_orig\":\"shape/present_veg\",\"environmentalvalueunits\":\"class\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:present_veg&format=image/png&styles=\",\"domain\":\"Terrestrial\",\"dt_added\":1317906000000,\"environmentalvaluemax\":\"99\",\"environmentalvaluemin\":\"0\",\"lookuptablepath\":\"\",\"citation_date\":\"2006\",\"datalang\":\"eng\",\"licence_level\":\"3\",\"mddatest\":\"2009-08\",\"mdhrlv\":\"\",\"respparty_role\":\"distributor\",\"keywords\":\"\",\"path_1km\":\"\",\"scale\":\"\",\"description\":\"Current major vegetation group (class)\",\"source\":\"ERIN\",\"name\":\"present_veg\",\"id\":620,\"type\":\"Contextual\",\"path\":\"/mnt/transfer/MCAS_1k_Datapack/Vegetation/present_veg.tif\"},{\"displayname\":\"NVIS 4.1 Major Vegetation Groups\",\"enabled\":true,\"uid\":\"2125\",\"metadatapath\":\"http://www.environment.gov.au/fed/catalog/search/resource/details.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"classification1\":\"Vegetation\",\"classification2\":\"Classification\",\"notes\":\"\",\"source_link\":\"http://www.environment.gov.au/fed/catalog/search/resource/downloadData.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"licence_link\":\"http://www.environment.gov.au/fed/catalog/search/resource/details.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"licence_notes\":\"Separate State/Territory acknowledgement required on citation\",\"maxlatitude\":-8.13987,\"minlatitude\":-44.31837,\"minlongitude\":109.50436,\"maxlongitude\":157.21622,\"pid\":\"\",\"shape\":true,\"path_orig\":\"shape_diva/nvis41_mvg\",\"environmentalvalueunits\":\"\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:nvis41_mvg&format=image/png&styles=\",\"domain\":\"Terrestrial\",\"dt_added\":1448542800000,\"environmentalvaluemax\":\"\",\"environmentalvaluemin\":\"\",\"lookuptablepath\":\"\",\"citation_date\":\"11/2012\",\"datalang\":\"\",\"licence_level\":\"2\",\"mddatest\":\"\",\"mdhrlv\":\"\",\"respparty_role\":\"custodian\",\"keywords\":\"dominant, tree, forest, woodland, canopy, understory\",\"path_1km\":\"\",\"scale\":\"\",\"description\":\"Major Vegetation Groups were identified to summarise the type and distribution of Australia's native vegetation. The classification contains different mixes of plant species within the canopy, shrub or ground layers, but are structurally similar and are often dominated by a single genus. In a mapping sense, the groups reflect the dominant vegetation occurring in a map unit where there are a mix of several vegetation types. Subdominant vegetation groups which may also be present in the map unit are not shown. For example, the dominant vegetation in an area may be mapped as dominated by eucalypt open forest, although it contains pockets of rainforest, shrubland and grassland vegetation as subdominants.\",\"source\":\"http://www.environment.gov.au/fed/catalog/search/resource/details.page?uuid=%7Beade4b5f-6a30-46ae-86d8-58ed374ddc72%7D\",\"name\":\"nvis41_mvg\",\"id\":2125,\"type\":\"Contextual\",\"path\":\"/data/ala/data/layers/ready/shape_diva\"},{\"displayname\":\"Occurrence Density\",\"enabled\":true,\"uid\":\"898\",\"metadatapath\":\"http://www.ala.org.au/\",\"classification1\":\"Biodiversity\",\"classification2\":\"\",\"notes\":\"Occurrence Density is derived by applying a moving average to all point occurrences held by the Atlas of Living Australia. If all occurrences are mapped (over terrestrial and marine areas), a moving average is like moving a window with many panes over the area, noting the number of occurrences in each pane and placing the average of all panes at the centre pane. The window is moved to the next sample location and the process repeated. Occurrence density uses a 9 by 9 pane window where each pane is 0.01 degrees latitude/longitude. Each move of the window is 0.01 degrees.\\r\\n\\r\\nScope: World\",\"source_link\":\"\",\"licence_link\":\"\",\"licence_notes\":\"\",\"maxlatitude\":-10.46623,\"minlatitude\":-36.41364,\"minlongitude\":96.79992,\"maxlongitude\":159.23333,\"pid\":\"\",\"grid\":true,\"path_orig\":\"diva/odensity\",\"environmentalvalueunits\":\"frequency\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:odensity&format=image/png&styles=\",\"domain\":\"Terrestrial, Marine\",\"dt_added\":1439388000000,\"environmentalvaluemax\":\"446649\",\"environmentalvaluemin\":\"0\",\"lookuptablepath\":\"\",\"citation_date\":\"\",\"datalang\":\"\",\"licence_level\":\"0\",\"mddatest\":\"\",\"mdhrlv\":\"\",\"respparty_role\":\"\",\"keywords\":\"average, sample\",\"path_1km\":\"\",\"scale\":\"0.01 degree (~1km)\",\"description\":\"Occurrence Density\",\"source\":\"ALA-SPATIAL\",\"name\":\"odensity\",\"id\":898,\"type\":\"Environmental\",\"path\":\"/data/ala/data/source/occurrence_layers/layer_occurrence_av_1.tif\"},{\"displayname\":\"Species Richness\",\"enabled\":true,\"uid\":\"899\",\"metadatapath\":\"http://www.ala.org.au/\",\"classification1\":\"Biodiversity\",\"classification2\":\"\",\"notes\":\"Species Richness is derived by applying a moving average to all point occurrences held by the Atlas of Living Australia. If all occurrences are mapped (over terrestrial and marine areas), a moving average is like moving a window with many panes over the area, noting the number of differences species in each pane and placing the average of all panes at the centre pane. The window is moved to the next sample location and the process repeated. Species Richness uses a 9 by 9 pane window where each pane is 0.01 degrees latitude/longitude. Each move of the window is 0.01 degrees.\\r\\n\\r\\nScope: World\",\"source_link\":\"\",\"licence_link\":\"\",\"licence_notes\":\"\",\"maxlatitude\":-9.0,\"minlatitude\":-43.8,\"minlongitude\":112.9,\"maxlongitude\":153.64,\"pid\":\"\",\"grid\":true,\"path_orig\":\"diva/srichness\",\"environmentalvalueunits\":\"frequency\",\"displaypath\":\"http://spatial.ala.org.au/geoserver/gwc/service/wms?service=WMS&version=1.1.0&request=GetMap&layers=ALA:srichness&format=image/png&styles=\",\"domain\":\"Terrestrial, Marine\",\"dt_added\":1439301600000,\"environmentalvaluemax\":\"7791\",\"environmentalvaluemin\":\"0\",\"lookuptablepath\":\"\",\"citation_date\":\"\",\"datalang\":\"\",\"licence_level\":\"0\",\"mddatest\":\"\",\"mdhrlv\":\"\",\"respparty_role\":\"\",\"keywords\":\"diversity, occurrence, sample, average\",\"path_1km\":\"\",\"scale\":\"0.01 degree (~1km)\",\"description\":\"Species Richness\",\"source\":\"ALA-SPATIAL\",\"name\":\"srichness\",\"id\":899,\"type\":\"Environmental\",\"path\":\"/data/ala/data/source/occurrence_layers/layer_species_av_1.tif\"}]"

        when:
        def check1 = diffService.hasChangedJsonDiff(json1, json1, query, true)
        then:
        check1 == false

        when:
        def check2 = diffService.hasChangedJsonDiff(json1, json2, query, true)
        then:
        check2 == true
    }
}
